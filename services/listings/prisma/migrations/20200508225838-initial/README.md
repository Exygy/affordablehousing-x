# Migration `20200508225838-initial`

This migration has been generated by Marcin Jedras at 5/8/2020, 10:58:38 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "AttachmentType" AS ENUM ('ApplicationDownload', 'ExternalApplication');

CREATE TABLE "public"."Listing" (
"acceptingApplicationsAtLeasingAgent" boolean  NOT NULL ,"acceptingApplicationsByPoBox" boolean  NOT NULL ,"acceptingOnlineApplications" boolean  NOT NULL ,"acceptsPostmarkedApplications" boolean  NOT NULL ,"accessibility" text  NOT NULL ,"amenities" text  NOT NULL ,"applicationAddressId" text  NOT NULL ,"applicationDueDate" text  NOT NULL ,"applicationFee" text  NOT NULL ,"applicationOpenDate" text  NOT NULL ,"applicationOrganization" text  NOT NULL ,"blankPaperApplicationCanBePickedUp" boolean  NOT NULL ,"buildingAddressId" text  NOT NULL ,"buildingSelectionCriteria" text  NOT NULL ,"buildingTotalUnits" integer  NOT NULL ,"costsNotIncluded" text  NOT NULL ,"creditHistory" text  NOT NULL ,"criminalBackground" text  NOT NULL ,"depositMax" text  NOT NULL ,"depositMin" text  NOT NULL ,"developer" text  NOT NULL ,"disableUnitsAccordion" boolean  NOT NULL ,"id" text  NOT NULL ,"imageUrl" text  NOT NULL ,"leasingAgentAddressId" text  NOT NULL ,"leasingAgentEmail" text  NOT NULL ,"leasingAgentName" text  NOT NULL ,"leasingAgentOfficeHours" text  NOT NULL ,"leasingAgentPhone" text  NOT NULL ,"leasingAgentTitle" text  NOT NULL ,"name" text  NOT NULL ,"neighborhood" text  NOT NULL ,"petPolicy" text  NOT NULL ,"postmarkedApplicationsReceivedByDate" text  NOT NULL ,"programRules" text  NOT NULL ,"rentalHistory" text  NOT NULL ,"requiredDocuments" text  NOT NULL ,"smokingPolicy" text  NOT NULL ,"unitAmenities" text  NOT NULL ,"unitsAvailable" integer  NOT NULL ,"urlSlug" text  NOT NULL ,"waitlistCurrentSize" integer  NOT NULL ,"waitlistMaxSize" integer  NOT NULL ,"yearBuilt" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Unit" (
"amiChartId" integer  NOT NULL ,"amiPercentage" text  NOT NULL ,"annualIncomeMax" text  NOT NULL ,"annualIncomeMin" text  NOT NULL ,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"floor" integer  NOT NULL ,"id" text  NOT NULL ,"listingId" text  NOT NULL ,"maxOccupancy" integer  NOT NULL ,"minOccupancy" integer  NOT NULL ,"monthlyIncomeMin" Decimal(65,30)  NOT NULL ,"monthlyRent" Decimal(65,30)  NOT NULL ,"monthlyRentAsPercentOfIncome" integer  NOT NULL ,"numBathrooms" integer  NOT NULL ,"numBedrooms" integer  NOT NULL ,"number" text  NOT NULL ,"priorityType" text  NOT NULL ,"reservedType" text  NOT NULL ,"sqFeet" Decimal(65,30)  NOT NULL ,"status" text  NOT NULL ,"unitType" text  NOT NULL ,"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Attachment" (
"fileUrl" text  NOT NULL ,"id" text  NOT NULL ,"label" text  NOT NULL ,"listingId" text  NOT NULL ,"type" "AttachmentType" NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Address" (
"city" text  NOT NULL ,"county" text  NOT NULL ,"id" text  NOT NULL ,"latitude" Decimal(65,30)  NOT NULL ,"longitude" Decimal(65,30)  NOT NULL ,"state" text  NOT NULL ,"street" text  NOT NULL ,"zipCode" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Preference" (
"description" text  NOT NULL ,"id" text  NOT NULL ,"links" jsonb  NOT NULL ,"listingId" text  NOT NULL ,"ordinal" text  NOT NULL ,"subtitle" text  NOT NULL ,"title" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE UNIQUE INDEX "Listing_applicationAddressId" ON "public"."Listing"("applicationAddressId")

CREATE UNIQUE INDEX "Listing_buildingAddressId" ON "public"."Listing"("buildingAddressId")

CREATE UNIQUE INDEX "Listing_leasingAgentAddressId" ON "public"."Listing"("leasingAgentAddressId")

ALTER TABLE "public"."Listing" ADD FOREIGN KEY ("applicationAddressId")REFERENCES "public"."Address"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Listing" ADD FOREIGN KEY ("buildingAddressId")REFERENCES "public"."Address"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Listing" ADD FOREIGN KEY ("leasingAgentAddressId")REFERENCES "public"."Address"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Unit" ADD FOREIGN KEY ("listingId")REFERENCES "public"."Listing"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Attachment" ADD FOREIGN KEY ("listingId")REFERENCES "public"."Listing"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Preference" ADD FOREIGN KEY ("listingId")REFERENCES "public"."Listing"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200508225838-initial
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,127 @@
+datasource db {
+  provider = "postgresql"
+  url      = env("DATABASE_URL")
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+model Listing {
+  id                                   String       @default(uuid()) @id
+  acceptingApplicationsAtLeasingAgent  Boolean
+  acceptingApplicationsByPoBox         Boolean
+  acceptingOnlineApplications          Boolean
+  acceptsPostmarkedApplications        Boolean
+  accessibility                        String
+  amenities                            String
+  applicationDueDate                   String
+  applicationOpenDate                  String
+  applicationFee                       String
+  applicationOrganization              String
+  applicationAddress                   Address      @relation("applicationAddress", fields: [applicationAddressId], references: [id])
+  applicationAddressId                 String
+  attachments                          Attachment[]
+  blankPaperApplicationCanBePickedUp   Boolean
+  buildingAddress                      Address      @relation("buildingAddress", fields: [buildingAddressId], references: [id])
+  buildingAddressId                    String
+  buildingTotalUnits                   Int
+  buildingSelectionCriteria            String
+  costsNotIncluded                     String
+  creditHistory                        String
+  criminalBackground                   String
+  depositMin                           String
+  depositMax                           String
+  developer                            String
+  disableUnitsAccordion                Boolean
+  imageUrl                             String
+  leasingAgentAddress                  Address      @relation("leasingAgentAddress", fields: [leasingAgentAddressId], references: [id])
+  leasingAgentAddressId                String
+  leasingAgentEmail                    String
+  leasingAgentName                     String
+  leasingAgentOfficeHours              String
+  leasingAgentPhone                    String
+  leasingAgentTitle                    String
+  name                                 String
+  neighborhood                         String
+  preferences                          Preference[]
+  petPolicy                            String
+  postmarkedApplicationsReceivedByDate String
+  programRules                         String
+  rentalHistory                        String
+  requiredDocuments                    String
+  smokingPolicy                        String
+  units                                Unit[]
+  unitsAvailable                       Int
+  unitAmenities                        String
+  // unitsSummarized                       UnitsSummarized
+  urlSlug                              String
+  waitlistCurrentSize                  Int
+  waitlistMaxSize                      Int
+  yearBuilt                            Int
+}
+
+model Unit {
+  id                           String   @default(uuid()) @id
+  amiPercentage                String
+  annualIncomeMin              String
+  monthlyIncomeMin             Float
+  floor                        Int
+  annualIncomeMax              String
+  maxOccupancy                 Int
+  minOccupancy                 Int
+  monthlyRent                  Float
+  numBathrooms                 Int
+  numBedrooms                  Int
+  number                       String
+  priorityType                 String
+  reservedType                 String
+  sqFeet                       Float
+  status                       String
+  unitType                     String
+  createdAt                    DateTime @default(now())
+  updatedAt                    DateTime @updatedAt
+  amiChartId                   Int
+  monthlyRentAsPercentOfIncome Int
+  listing                      Listing  @relation(fields: [listingId], references: [id])
+  listingId                    String
+}
+
+model Attachment {
+  id        String         @default(uuid()) @id
+  label     String
+  fileUrl   String
+  type      AttachmentType
+  listing   Listing        @relation(fields: [listingId], references: [id])
+  listingId String
+}
+
+model Address {
+  id                  String   @default(uuid()) @id
+  city                String
+  county              String
+  state               String
+  street              String
+  zipCode             String
+  latitude            Float
+  longitude           Float
+  leasingAgentAddress Listing? @relation("leasingAgentAddress")
+  buildingAddress     Listing? @relation("buildingAddress")
+  applicationAddress  Listing? @relation("applicationAddress")
+}
+
+model Preference {
+  id          String  @default(uuid()) @id
+  ordinal     String
+  title       String
+  subtitle    String
+  description String
+  links       Json
+  listing     Listing @relation(fields: [listingId], references: [id])
+  listingId   String
+}
+
+enum AttachmentType {
+  ApplicationDownload
+  ExternalApplication
+}
```


